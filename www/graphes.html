<html>
	<head>
		<title>Graphed values</title>
	</head>
	<body>
		<table>
			<thead>
				<th>Team</th>
				<th>X Acceleration</th>
				<th>Y Acceleration</th>
				<th>Z Acceleration</th>
				<th>Body temperature</th>
			</thead>
			<tr>
				<td>$TEAMS_0_M</td>
				<td><canvas id="canvas_0_X" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_0_Y" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_0_Z" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_0_T" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
			</tr>
			<tr>
				<td>$TEAMS_1_M</td>
				<td><canvas id="canvas_1_X" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_1_Y" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_1_Z" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_1_T" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
			</tr>
			<tr>
				<td>$TEAMS_2_M</td>
				<td><canvas id="canvas_2_X" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_2_Y" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_2_Z" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_2_T" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
			</tr>
			<tr>
				<td>$TEAMS_3_M</td>
				<td><canvas id="canvas_3_X" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_3_Y" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_3_Z" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_3_T" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
			</tr>
			<tr>
				<td>$TEAMS_4_M</td>
				<td><canvas id="canvas_4_X" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_4_Y" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_4_Z" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_4_T" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
			</tr>
			<tr>
				<td>$TEAMS_5_M</td>
				<td><canvas id="canvas_5_X" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_5_Y" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_5_Z" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_5_T" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
			</tr>
			<tr>
				<td>$TEAMS_6_M</td>
				<td><canvas id="canvas_6_X" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_6_Y" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_6_Z" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_6_T" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
			</tr>
			<tr>
				<td>$TEAMS_7_M</td>
				<td><canvas id="canvas_7_X" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_7_Y" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_7_Z" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_7_T" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
			</tr>
			<tr>
				<td>$TEAMS_8_M</td>
				<td><canvas id="canvas_8_X" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_8_Y" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_8_Z" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_8_T" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
			</tr>
			<tr>
				<td>$TEAMS_9_M</td>
				<td><canvas id="canvas_9_X" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_9_Y" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_9_Z" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_9_T" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
			</tr>
			<tr>
				<td>$TEAMS_10_M</td>
				<td><canvas id="canvas_10_X" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_10_Y" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_10_Z" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
				<td><canvas id="canvas_10_T" width="150" height="50" style="border:1px solid #d3d3d3;">Canvas not supported by your browser</canvas></td>
			</tr>
			<tr>
				<td>Reading range</td>
				<td colspan="3">
					From <input id="from" type="text" value="01 JAN 1970 01:00:00" />
					To <input id="to" type="text" value="19 JAN 2038 04:14:07" />
				</td>
				<td align="right"><input type="button" value="Change range" onclick="refreshCanvas();" /></td>
			</tr>
		</table>
		<script>
// Constants
MAX_TEAM=11;
MAX_DATA=150;
DATA_TYPE=['X', 'Y', 'Z', 'T'];

// Global
var teamData = [];

// File function
function file(fichier)
{
	if(window.XMLHttpRequest)
		xhr_object = new XMLHttpRequest();
	else if(window.ActiveXObject)
		xhr_object = new ActiveXObject("Microsoft.XMLHTTP");
	else
		return(false);
	xhr_object.open("GET", fichier, false);
	xhr_object.send(null);
	if(xhr_object.readyState == 4)
		return(xhr_object.responseText);
    else
		return(false);
}

// Canvas function
function refreshCanvas()
{
	var from = document.getElementById("from").value;
	from = Date.parse(from);
	var to = document.getElementById("to").value;
	to = Date.parse(to);
	for(i=0; i<MAX_TEAM; i++)
	{
		var sortable = [];
		var thisTeamDataX = [];
		var thisTeamDataY = [];
		var thisTeamDataZ = [];
		var thisTeamDataT = [];
		var dataInRange = 0;
		var max = 0;
		for(var data in teamData[i])
			sortable.push(data);
		sortable.sort(function(a, b) {return b - a});
		max=(sortable.length < MAX_DATA) ? sortable.length : MAX_DATA;
		for(j=0; j<max; j++)
		{
			console.log("Team "+i+" Index "+j+" Max "+max+" Obj Index "+sortable[j]);
			if(dataInRange >= from && dataInRange <= to)
			{
				thisTeamDataX[dataInRange] = teamData[i][sortable[j]]["x"];
				thisTeamDataY[dataInRange] = teamData[i][sortable[j]]["y"];
				thisTeamDataZ[dataInRange] = teamData[i][sortable[j]]["z"];
				thisTeamDataT[dataInRange] = teamData[i][sortable[j]]["t"];
				dataInRange++;
			}
		}
		if(dataInRange == 0)
		{
			for(j=0; j<4; j++)
			{
				var c = document.getElementById("canvas_"+i+"_"+DATA_TYPE[j]);
				var ctx = c.getContext("2d");
				ctx.setTransform(1, 0, 0, 1, 0, 0);
				ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);
				ctx.fillStyle = "#FF0000";
				ctx.font = "30px Arial";
				ctx.fillText("No Data",20,35);
			}
		}
		else
		{
			for(j=0; j<4; j++)
			{
				var c = document.getElementById("canvas_"+i+"_"+DATA_TYPE[j]);
				var ctx = c.getContext("2d");
				ctx.setTransform(1, 0, 0, 1, 0, 0);
				ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height);
				//var ctx = c.getContext("2d");
				//ctx.beginPath();
				//ctx.moveTo(0, 150);
				//ctx.lineTo(0, 100);
				//ctx.stroke();
			}
		}
	}
}

// Load all JSON files
for(i=0; i<MAX_TEAM; i++)
	teamData[i] = JSON.parse(file("team"+i+".json"));

// Initializing all canvas
for(i=0; i<MAX_TEAM; i++)
	for(j=0; j<4; j++)
	{
		var c = document.getElementById("canvas_"+i+"_"+DATA_TYPE[j]);
		var ctx = c.getContext("2d");
		ctx.fillStyle = "#FF0000";
		ctx.font = "30px Arial";
		ctx.fillText("No Data",20,35);
	}

refreshCanvas();
		</script>
	</body>
</html>
